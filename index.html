<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investimentos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Carregando seus dados...</p>
    </div>
    <input type="file" id="import-backup-comparacao-input" accept=".json" style="display: none;">
    <input type="file" id="restore-file-input" accept=".json" style="display: none;">
    <input type="file" id="input-arquivo-cotacoes" accept=".csv" style="display: none;">
    <input type="file" id="input-cadastros-csv" accept=".csv" style="display: none;">
    <input type="file" id="input-arquivo-proventos" accept=".csv" style="display: none;">
    <div id="modal-calendario-recorrentes" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 1600px;">
            <h3 id="modal-calendario-recorrentes-titulo">Calendário de Lançamentos Recorrentes</h3>
            <div id="calendario-recorrentes-container"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-historico-ativo-snapshot" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h3 id="modal-historico-ativo-snapshot-titulo">Histórico do Ativo</h3>
            <div class="grafico-barras-container" style="height: 300px; margin-top: 20px;">
                <canvas id="grafico-historico-ativo-snapshot"></canvas>
            </div>
            <div id="container-historico-ativo-snapshot" class="tabela-projecao-wrapper" style="margin-top: 20px;">
                </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-lista-ativos-cnpj" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 id="modal-cnpj-titulo"></h3>
            <div id="modal-cnpj-conteudo" style="margin-top: 15px; font-size: 1.1em; line-height: 1.6;">
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-cadastro-ativo-rf" class="modal">
        <div class="modal-content">
            <h3 id="modal-ativo-rf-titulo">Nova Aplicação em Renda Fixa</h3>
            <form id="form-cadastro-ativo-rf">
                <input type="hidden" id="ativo-rf-id">
                <div class="form-group">
                    <label for="ativo-rf-descricao">Descrição do Ativo</label>
                    <input type="text" id="ativo-rf-descricao" placeholder="Ex: CDB Neon 113% CDI" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ativo-rf-instituicao">Instituição/Corretora</label>
                        <select id="ativo-rf-instituicao" required></select>
                    </div>
                    <div class="form-group">
                        <label for="ativo-rf-valor-investido">Valor Investido (R$)</label>
                        <input type="text" id="ativo-rf-valor-investido" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ativo-rf-data-aplicacao">Data da Aplicação</label>
                        <input type="date" id="ativo-rf-data-aplicacao" required>
                    </div>
                    <div class="form-group">
                        <label for="ativo-rf-data-vencimento">Data de Vencimento</label>
                        <input type="date" id="ativo-rf-data-vencimento" required>
                    </div>
                </div>
                <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px;">
                    <input type="checkbox" id="ativo-rf-isento-ir" style="width: auto;">
                    <label for="ativo-rf-isento-ir" style="margin: 0;">Este investimento é isento de Imposto de Renda (LCI, LCA, etc.)</label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Aplicação</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="modal-aporte-rf" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>Aportar em Renda Fixa</h3>
            <p>Ativo: <strong id="aporte-rf-descricao"></strong></p>
            <form id="form-aporte-rf">
                <input type="hidden" id="aporte-rf-id">
                <div class="form-group">
                    <label for="aporte-rf-valor">Valor do Aporte (R$)</label>
                    <input type="text" id="aporte-rf-valor" required>
                </div>
                <div class="form-group">
                    <label for="aporte-rf-data">Data do Aporte</label>
                    <input type="date" id="aporte-rf-data" required>
                </div>
                <div class="form-group">
                    <label for="aporte-rf-conta-origem">Conta de Origem do Recurso</label>
                    <select id="aporte-rf-conta-origem" required></select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Confirmar Aporte</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-resgate-rf" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>Resgatar de Renda Fixa</h3>
            <p>Ativo: <strong id="resgate-rf-descricao"></strong></p>
            <p>Saldo Líquido Atual: <strong id="resgate-rf-saldo-atual"></strong></p>
            <form id="form-resgate-rf">
                <input type="hidden" id="resgate-rf-id">
                 <div class="form-group">
                    <label for="resgate-rf-valor">Valor Líquido Resgatado (R$)</label>
                    <input type="text" id="resgate-rf-valor" required>
                </div>
                <div class="form-group">
                    <label for="resgate-rf-data">Data do Resgate</label>
                    <input type="date" id="resgate-rf-data" required>
                </div>
                <div class="form-group">
                    <label for="resgate-rf-conta-destino">Conta de Destino do Recurso</label>
                    <select id="resgate-rf-conta-destino" required></select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Confirmar Resgate</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-historico-rf" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="historico-rf-titulo">Histórico de Movimentações</h3>
            <p>Ativo: <strong id="historico-rf-descricao"></strong></p>
            <div id="historico-rf-container"></div>
            <div class="form-actions">
            </div>
        </div>
    </div>
    <div id="modal-performance-ativo-grafico" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3 id="modal-performance-ativo-titulo"></h3>
            <div id="modal-performance-ativo-info" style="text-align: center; margin-bottom: 20px; font-size: 1.1em;"></div>
            <div style="height: 120px; margin-top: 20px;">
                <canvas id="grafico-comparativo-preco"></canvas>
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-detalhes-ir-mes" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="modal-detalhes-ir-titulo"></h3>
            <div id="modal-detalhes-ir-conteudo">
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-evento-ativo" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3 id="modal-evento-ativo-titulo">Registrar Evento de Ativo</h3>
            <form id="form-evento-ativo">
                <input type="hidden" id="evento-ativo-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="evento-ativo-tipo">Tipo de Evento</label>
                        <select id="evento-ativo-tipo" required>
                            <option value="">Selecione...</option>
                            <option value="entrada">Entrada de Ativo</option>
                            <option value="saida">Saída de Ativo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="evento-ativo-data">Data do Evento</label>
                        <input type="date" id="evento-ativo-data" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="evento-ativo-ticker">Ativo (Ticker)</label>
                    <input type="text" id="evento-ativo-ticker" class="ticker-input" required>
                </div>

                <div id="container-evento-entrada-fields" style="display: none;">
                    <p style="font-size: 0.9em; color: #555; margin-top: 15px;">Informe o custo de aquisição (preço médio) e a quantidade que entrou em cada corretora.</p>
                    <div class="form-group">
                        <label for="evento-ativo-pm">Preço Médio de Aquisição (R$)</label>
                        <input type="text" id="evento-ativo-pm" placeholder="Para bonificação, use 0,00" required>
                    </div>
                    <h4>Quantidade por Corretora</h4>
                    <div id="evento-entrada-corretoras-container">
                        </div>
                </div>

                <div id="container-evento-saida-fields" style="display: none;">
                    <p style="font-size: 0.9em; color: #555; margin-top: 15px;">Sua posição na data selecionada está abaixo. Informe a quantidade a ser retirada de cada corretora.</p>
                    <div id="evento-saida-posicao-container">
                         </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Evento</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-corrigir-proventos-orfaos" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h3>Corrigir Posição para Proventos Órfãos</h3>
            <p>Para os proventos listados abaixo, não foi encontrada posição na "Data Com". Informe a quantidade e o preço médio que você possuía nesta data para corrigir o histórico.</p>
            <form id="form-correcao-proventos">
                <div id="lista-proventos-orfaos-container" style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    </div>
                <div class="form-actions">
                    <button type="button" id="btn-salvar-correcao-proventos" class="btn btn-success">Salvar Correções</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-corrigir-contas-sem-moeda" class="modal">
        <div class="modal-content" style="max-width: 950px;">
            <h3>Corrigir Contas com Moeda Não Especificada</h3>
            <p>As contas abaixo foram cadastradas antes da implementação de multi-moedas. Por favor, especifique a moeda para cada uma. Para contas em BRL, confirme ou atualize os dados bancários.</p>
            <form id="form-correcao-contas-sem-moeda">
                <div id="lista-contas-sem-moeda-container" style="max-height: 500px; overflow-y: auto; margin-top: 15px;">
                    </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Correções</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-nova-transacao-moeda" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="modal-transacao-moeda-titulo">Nova Movimentação</h3>
            <form id="form-nova-transacao-moeda">
                <input type="hidden" id="transacao-moeda-id">
                <input type="hidden" id="transacao-moeda-transferencia-id">
                <input type="hidden" id="transacao-moeda-source-mae-id">
                <input type="hidden" id="transacao-moeda-source-ocorrencia-data">
                <div class="form-group" id="tipo-transacao-moeda-seletor">
                    <label>Tipo de Lançamento</label>
                    <div class="radio-group">
                        <input type="radio" id="tipo-transacao-moeda-unica" name="tipo-transacao-moeda" value="unica" checked>
                        <label for="tipo-transacao-moeda-unica">Única / Transferência</label>
                        <input type="radio" id="tipo-transacao-moeda-recorrente" name="tipo-transacao-moeda" value="recorrente">
                        <label for="tipo-transacao-moeda-recorrente">Recorrente</label>
                    </div>
                </div>
            
                <div class="form-row">
                    <div class="form-group">
                        <label for="transacao-moeda-data">Data</label>
                        <input type="date" id="transacao-moeda-data" required>
                    </div>
                    <div class="form-group">
                        <label for="transacao-moeda-valor-debito">Valor</label>
                        <div class="input-com-simbolo">
                            <span class="moeda-simbolo" id="transacao-moeda-simbolo-debito"></span>
                            <input type="text" id="transacao-moeda-valor-debito" required>
                        </div>
                    </div>
                </div>
            
                <div class="form-group" id="container-valor-credito" style="display: none;">
                    <label for="transacao-moeda-valor-credito">Valor do Crédito (na moeda de destino)</label>
                    <div class="input-com-simbolo">
                        <span class="moeda-simbolo" id="transacao-moeda-simbolo-credito"></span>
                        <input type="text" id="transacao-moeda-valor-credito">
                    </div>
                    <small id="info-cambio" style="font-style: italic; color: #555; margin-top: 5px;"></small>
                </div>
            
                <div id="container-contas-transferencia-moeda" class="form-row">
                    <div class="form-group">
                        <label for="transacao-moeda-conta-debito">Conta de Débito (Origem)</label>
                        <select id="transacao-moeda-conta-debito"></select>
                    </div>
                    <div class="form-group">
                        <label for="transacao-moeda-conta-credito">Conta de Crédito (Destino)</label>
                        <select id="transacao-moeda-conta-credito"></select>
                    </div>
                </div>
                <div id="container-contas-recorrente-moeda" class="form-row" style="display: none;">
                    <div class="form-group">
                        <label for="transacao-moeda-tipo-recorrente">Tipo de Movimento</label>
                        <select id="transacao-moeda-tipo-recorrente">
                            <option value="entrada">Entrada</option>
                            <option value="saida">Saída</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transacao-moeda-ativo-recorrente">Ativo</label>
                        <select id="transacao-moeda-ativo-recorrente"></select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="transacao-moeda-descricao">Descrição (Opcional para transferências)</label>
                    <input type="text" id="transacao-moeda-descricao">
                </div>
                
                <div id="recorrencia-moeda-options" style="display: none;">
                    <hr>
                    <h4>Detalhes da Recorrência</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="recorrencia-moeda-frequencia">Frequência</label>
                            <select id="recorrencia-moeda-frequencia">
                                <option value="mensal">Mensal</option>
                                <option value="quinzenal">Quinzenal (14 dias)</option>
                                <option value="semanal">Semanal</option>
                            </select>
                        </div>
                        <div class="form-group" id="recorrencia-moeda-dia-mes-group">
                            <label for="recorrencia-moeda-dia-mes">Dia do Mês</label>
                            <input type="number" id="recorrencia-moeda-dia-mes" min="1" max="31">
                        </div>
                        <div class="form-group" id="recorrencia-moeda-dia-semana-group" style="display: none;">
                            <label for="recorrencia-moeda-dia-semana">Dia da Semana</label>
                            <select id="recorrencia-moeda-dia-semana">
                                <option value="1">Segunda</option> <option value="2">Terça</option> <option value="3">Quarta</option>
                                <option value="4">Quinta</option> <option value="5">Sexta</option> <option value="6">Sábado</option> <option value="0">Domingo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Condição de Término</label>
                        <div class="radio-group">
                            <input type="radio" id="termino-moeda-ocorrencias" name="tipo-termino-moeda" value="ocorrencias" checked>
                            <label for="termino-moeda-ocorrencias">Após X vezes</label>
                            <input type="radio" id="termino-moeda-data" name="tipo-termino-moeda" value="data">
                            <label for="termino-moeda-data">Em uma data</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="termino-moeda-ocorrencias-valor-group">
                            <label for="termino-moeda-ocorrencias-valor">Número de Ocorrências</label>
                            <input type="number" id="termino-moeda-ocorrencias-valor" min="2" placeholder="Ex: 12">
                        </div>
                        <div class="form-group" id="termino-moeda-data-valor-group" style="display: none;">
                            <label for="termino-moeda-data-valor">Data Final</label>
                            <input type="date" id="termino-moeda-data-valor">
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Movimentação</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-acao-recorrente" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" id="fechar-modal-recorrente-btn">&times;</span> 
            <h3>Ação para Transação Recorrente</h3>
            <p>O que você deseja fazer com esta ocorrência?</p>
            <p><strong>Descrição:</strong> <span id="recorrente-info-descricao"></span></p>
            <p><strong>Valor:</strong> <span id="recorrente-info-valor"></span> | <strong>Data:</strong> <span id="recorrente-info-data"></span></p>
            
            <hr>
            
            <div id="recorrente-botoes-acao">
                </div>

            <button class="btn-cancelar" onclick="fecharModal('modal-acao-recorrente')">Cancelar</button>
        </div>
    </div>
    <div id="modal-balanceamento-detalhes" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <h3 id="modal-balanceamento-titulo">Análise de Balanceamento</h3>
            <div id="modal-balanceamento-container"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-evento-corporativo" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="modal-evento-titulo">Registrar Novo Evento Corporativo</h3>
            <form id="form-evento-corporativo">
                <input type="hidden" id="evento-id">
                <div class="form-row">
                    <div class="form-group" style="flex-grow: 3;">
                        <label for="evento-ticker">Ativo (Ticker)</label>
                        <input type="text" id="evento-ticker" class="ticker-input" required>
                    </div>
                     <div class="form-group">
                        <label for="evento-data">Data-Ex do Evento</label>
                        <input type="date" id="evento-data" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="evento-tipo">Tipo de Evento</label>
                        <select id="evento-tipo" required>
                            <option value="">Selecione...</option>
                            <option value="split">Desdobramento (Split)</option>
                            <option value="grupamento">Grupamento (Inplit)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Proporção (De)</label>
                        <input type="number" id="evento-proporcao-de" min="1" required placeholder="Ex: 10">
                    </div>
                    <div class="form-group">
                        <label>Proporção (Para)</label>
                        <input type="number" id="evento-proporcao-para" min="1" required placeholder="Ex: 1">
                    </div>
                </div>
                <p style="font-size: 0.85em; color: #666; margin-top: -10px;">
                    Ex: Para um grupamento de 10 para 1, preencha De: 10, Para: 1. <br>
                    Para um split de 1 para 4, preencha De: 1, Para: 4.
                </p>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Evento</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-corrigir-data" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 id="modal-corrigir-data-titulo">Corrigir Data do Registro</h3>
            <p id="modal-corrigir-data-descricao"></p>
            <form id="form-corrigir-data">
                <input type="hidden" id="corrigir-data-record-type">
                <input type="hidden" id="corrigir-data-record-id">
                <div class="form-group">
                    <label for="corrigir-data-input">Nova Data</label>
                    <input type="date" id="corrigir-data-input" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Nova Data</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-performance-detalhes" class="modal">
        <div class="modal-content" style="max-width: 950px;">
            <h3 id="modal-tir-titulo">Taxa Interna de Retorno (TIR)</h3>
            <div id="modal-tir-container-geral"></div>
            <hr style="margin: 20px 0;">
            <div id="modal-tir-container-individual"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-resumo-dividendos-ativo" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="page-header" style="justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 id="modal-resumo-dividendos-titulo" style="margin-bottom: 0;">Resumo de Proventos do Ativo</h3>
                <i class="fas fa-print fa-lg acao-btn" id="btn-imprimir-resumo-ativo" title="Imprimir Relatório do Ativo"></i>
            </div>
            <div id="resumo-dividendos-container">
                <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px 25px; margin-top: 15px;">
                    ${projectionHtml}
                </div>
                
                <div style="margin-top: 25px;">
                    <h4>Evolução Anual de Proventos Pagos</h4>
                    <div class="grafico-barras-container" style="height: 300px;">
                        <canvas id="grafico-resumo-proventos-anual"></canvas>
                    </div>
                </div>
                ${frequenciaHtml}
                </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-edicao-transacao-provento" class="modal">
        <div class="modal-content">
            <h3>Editar Valor do Provento Recebido</h3>
            <form id="form-edicao-transacao-provento">
                <input type="hidden" id="edit-trans-provento-id">
                <p>Você está editando o valor recebido na sua conta referente a um provento. A alteração aqui NÃO irá alterar o registo original do provento.</p>
                <div class="form-grid">
                    <div class="form-group"><label>Ativo</label><input type="text" id="edit-trans-provento-ticker" readonly></div>
                    <div class="form-group"><label>Tipo</label><input type="text" id="edit-trans-provento-tipo" readonly></div>
                    <div class="form-group"><label>Data Pag.</label><input type="text" id="edit-trans-provento-data" readonly></div>
                </div>
                <div class="form-group">
                    <label for="edit-trans-provento-valor">Novo Valor Total Recebido (R$)</label>
                    <input type="text" id="edit-trans-provento-valor" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Alteração</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-cadastro-feriado" class="modal">
        <div class="modal-content">
            <h3 id="modal-feriado-titulo">Cadastrar Novo Feriado</h3>
            <form id="form-cadastro-feriado">
                <input type="hidden" id="feriado-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="feriado-data">Data</label>
                        <input type="date" id="feriado-data" required>
                    </div>
                    <div class="form-group">
                        <label for="feriado-descricao">Descrição</label>
                        <input type="text" id="feriado-descricao" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Feriado</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-cadastro-conta" class="modal">
        <div class="modal-content">
            <h3 id="modal-conta-titulo">Cadastrar Nova Conta / Ativo em Moeda</h3>
            <form id="form-cadastro-conta">
                <input type="hidden" id="conta-id">
                <input type="hidden" id="conta-tipo-original">
                <div class="form-row">
                    <div class="form-group">
                        <label for="conta-moeda">Moeda</label>
                        <select id="conta-moeda" required>
                            <option value="BRL">Real (BRL)</option>
                            <option value="USD">Dólar (USD)</option>
                            <option value="EUR">Euro (EUR)</option>
                            <option value="GBP">Libra (GBP)</option>
                        </select>
                    </div>
                    <div class="form-group" id="container-nome-ativo-moeda">
                        <label for="conta-nome-ativo">Nome da Conta / Ativo</label>
                        <input type="text" id="conta-nome-ativo" placeholder="Ex: Conta na Avenue">
                    </div>
                </div>
                <div id="container-detalhes-brl">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conta-banco">Banco</label>
                            <select id="conta-banco">
                                <option value="">Selecione...</option>
                                <option value="Nubank">Nubank</option>
                                <option value="XP">XP</option>
                                <option value="RICO">RICO</option>
                                <option value="ÍON ITAÚ">ÍON ITAÚ</option>
                                <option value="TORO">TORO</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group" id="container-outro-banco" style="display: none;">
                            <label for="conta-outro-banco">Nome do Banco</label>
                            <input type="text" id="conta-outro-banco">
                        </div>
                        <div class="form-group">
                            <label for="conta-tipo">Tipo de Conta</label>
                            <select id="conta-tipo">
                                <option value="Conta Corrente">Conta Corrente</option>
                                <option value="Conta Investimento">Conta Investimento</option>
                                <option value="Poupança">Poupança</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="conta-numero-banco">Número do Banco</label><input type="text" id="conta-numero-banco"></div>
                        <div class="form-group"><label for="conta-agencia">Agência</label><input type="text" id="conta-agencia"></div>
                        <div class="form-group"><label for="conta-numero">Conta</label><input type="text" id="conta-numero"></div>
                    </div>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="conta-pix">Chave Pix</label>
                            <input type="text" id="conta-pix">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="conta-saldo-inicial" id="label-saldo-inicial">Saldo Inicial (BRL)</label>
                        <input type="text" id="conta-saldo-inicial" placeholder="1.000,00" required>
                    </div>
                    <div class="form-group">
                        <label for="conta-data-saldo-inicial">Data do Saldo Inicial</label>
                        <input type="date" id="conta-data-saldo-inicial" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="conta-notas">Notas (inclua "inativa" ou "encerrada" para ocultar a conta)</label>
                    <textarea id="conta-notas" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-lancamento-provento" class="modal">
        <div class="modal-content">
            <h3 id="provento-modal-titulo">Lançar Provento</h3>
            <form id="form-lancamento-provento">
                <input type="hidden" id="provento-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="provento-ativo">Ativo</label>
                        <input type="text" id="provento-ativo" class="ticker-input" required>
                    </div>
                    <div class="form-group">
                        <label for="provento-tipo">Tipo</label>
                        <select id="provento-tipo" required>
                            <option value="">Selecione...</option>
                            <option value="Rendimento">Rendimento</option>
                            <option value="Dividendo">Dividendo</option>
                            <option value="JCP">Juros sobre Capital Próprio</option>
                            <option value="Bonificação">Bonificação</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="provento-data-com">Data COM</label>
                        <input type="date" id="provento-data-com" required>
                    </div>
                    <div class="form-group">
                        <label for="provento-data-pagamento">Data do Pagamento</label>
                        <input type="date" id="provento-data-pagamento" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="provento-valor-individual">Valor Bruto por Unidade (R$)</label>
                        <input type="text" id="provento-valor-individual" placeholder="Use vírgula para decimais" required>
                    </div>
                    <div class="form-group">
                        <label for="provento-ir">Alíquota de IR (%)</label>
                        <input type="text" id="provento-ir" placeholder="Ex: 15">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Provento</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-posicao-inicial" class="modal">
        <div class="modal-content">
            <h3 id="posicao-modal-titulo">Adicionar Posição Inicial</h3>
            <form id="form-posicao-inicial">
                <input type="hidden" id="posicao-id">
                <div class="form-row">
                    <div class="form-group"><label for="posicao-ativo">Ativo</label><input type="text" id="posicao-ativo" class="ticker-input" required></div>
                    <div class="form-group"><label for="posicao-data">Data da Posição</label><input type="date" id="posicao-data" required></div>
                </div>
                 <div class="form-group"><label for="posicao-preco-medio">Preço Médio de Aquisição</label><input type="text" id="posicao-preco-medio" placeholder="Use vírgula para decimais" required></div>
                <hr style="margin: 20px 0;">
                <h4>Posições por Corretora</h4>
                <div id="posicoes-corretoras-container"></div>
                <button type="button" class="btn btn-primary btn-add-row" id="btn-add-corretora-row"><i class="fas fa-plus"></i> Adicionar Corretora</button>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Posição</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-cadastro-ativo" class="modal">
        <div class="modal-content">
            <h3 id="modal-ativo-titulo">Cadastrar Novo Ativo</h3>
            <form id="form-cadastro-ativo">
                <input type="hidden" id="ativo-id">
                <div class="form-row">
                    <div class="form-group" style="flex-basis: 200px; flex-grow: 2;"><label for="ativo-ticker">Ticker</label><input type="text" id="ativo-ticker" class="ticker-input" required></div>
                    <div class="form-group"><label for="ativo-tipo">Tipo de Ativo</label><select id="ativo-tipo" required><option value="">Selecione...</option><option value="Ação">Ação</option><option value="FII">FII</option><option value="ETF">ETF</option></select></div>
                </div>
                <div class="form-group"><label for="ativo-nome-pregao">Nome no Pregão</label><input type="text" id="ativo-nome-pregao"></div>
                <div class="form-group"><label for="ativo-nome">Nome do Ativo/Fundo</label><input type="text" id="ativo-nome"></div>
                <div class="form-group"><label for="ativo-cnpj">CNPJ do Ativo/Fundo</label><input type="text" id="ativo-cnpj" maxlength="18"></div>
                
                <div id="acao-tipo-fields" style="display: none;">
                    <hr>
                    <h4>Dados da Ação</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ativo-tipo-acao">Tipo de Ação</label>
                            <select id="ativo-tipo-acao">
                                <option value="">N/A</option>
                                <option value="ON">ON</option>
                                <option value="PN">PN</option>
                                <option value="Unit">Unit</option>
                            </select>
                        </div>
                        <div class="form-group" id="acao-meta-yield-bazin-fields">
                            <label for="ativo-meta-yield-bazin">Meta de Yield (Bazin) (%)</label>
                            <input type="text" id="ativo-meta-yield-bazin" placeholder="6,00">
                        </div>
                    </div>
                </div>

                <div id="fii-admin-fields" style="display: none;">
                    <hr>
                    <h4>Dados da Administradora (Apenas para FIIs)</h4>
                    <div class="form-group"><label for="ativo-admin-nome">Nome da Administradora</label><input type="text" id="ativo-admin-nome"></div>
                    <div class="form-group"><label for="ativo-admin-cnpj">CNPJ da Administradora</label><input type="text" id="ativo-admin-cnpj" maxlength="18"></div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Ativo</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-edicao-operacao" class="modal">
        <div class="modal-content">
            <h3>Editar Operação</h3>
            <form id="form-edicao-operacao">
                <input type="hidden" id="edit-op-id">
                <div class="form-grid">
                    <div class="form-group"><label for="edit-op-ativo">Ativo</label><input type="text" id="edit-op-ativo" required class="ticker-input" readonly></div>
                    <div class="form-group"><label for="edit-op-tipo">Operação</label><select id="edit-op-tipo"><option value="compra">Compra</option><option value="venda">Venda</option></select></div>
                    <div class="form-group"><label for="edit-op-quantidade">Quantidade</label><input type="number" id="edit-op-quantidade" step="1" required></div>
                    <div class="form-group"><label for="edit-op-valor">Valor Total</label><input type="text" id="edit-op-valor" required></div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-informar-valores-venda" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3>Corrigir Valor de Vendas Históricas</h3>
            <p>As vendas abaixo foram registradas no seu histórico, mas não possuem um valor de venda associado. Informe o valor total da venda (sem custos) para cada operação para garantir a precisão da Calculadora de IR.</p>
            <form id="form-valores-venda">
                <div id="lista-vendas-historicas-container" style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Valores Informados</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modal-proventos-calendario" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 1400px;">
            <h3 id="modal-calendario-titulo">
                Calendário de Rendimentos de FIIs
            </h3>
            <div id="calendario-container"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-proventos-calendario-acoes" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 1400px;">
            <h3 id="modal-calendario-acoes-titulo">
                Calendário de Proventos de Ações
            </h3>
            <div id="calendario-container-acoes"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-proventos-anuais" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <h3>Resumo Anual de Rendimentos</h3>
            <div id="container-proventos-anuais">
                </div>
            <div id="footnotes-proventos-anuais" style="margin-top: 15px; font-size: 0.85em; color: #555;">
                </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-projecao-futura" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 1400px;">
            <h3 id="modal-projecao-titulo">Projeção de Saldos Futuros</h3>
            <div id="container-projecao-futura"></div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-detalhes-rendimento" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="modal-detalhes-rendimento-titulo">Detalhes do Rendimento</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <div id="container-detalhes-rendimento" class="tabela-projecao-wrapper">
                    </div>
            </div>
        </div>
    </div>
    <div id="modal-dashboard-detalhes" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3 id="modal-dashboard-detalhes-titulo"></h3>
            <div id="modal-dashboard-detalhes-conteudo">
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>

    <nav class="sidebar">
        <ul>
            <li class="menu-item">
                <a href="#" data-tela="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                    <div id="dashboard-alert-icon-container" title="Verificar status e alertas da carteira">
                        <i class="fas fa-info-circle dashboard-alert-icon" id="dashboard-alert-icon"></i>
                        <span class="dashboard-alert-badge" id="dashboard-alert-badge" style="display: none;">0</span>
                    </div>
                    </a>
            </li>
            <li class="menu-item" id="menu-investimentos">
                <div class="menu-parent"><span class="icon"><i class="fas fa-briefcase"></i></span> Investimentos</div>
                 <ul class="submenu">
                    <li><a data-tela="rendaVariavel"><span class="icon"><i class="fas fa-chart-line"></i></span> Renda Variável</a></li>
                    <li><a data-tela="rendaFixa"><span class="icon"><i class="fas fa-piggy-bank"></i></span> Renda Fixa</a></li>
                    <li><a data-tela="listaNotas"><span class="icon"><i class="fas fa-receipt"></i></span> Notas de Negociação</a></li>
                    <li><a data-tela="negociar"><span class="icon"><i class="fas fa-exchange-alt"></i></span> Simulador de Negociação</a></li>
                    <li><a data-tela="consultaBalanceamento"><span class="icon"><i class="fas fa-balance-scale"></i></span> Alocação Estratégica</a></li>
                </ul>
            </li>
             <li class="menu-item"><a data-tela="caixaGlobal"><span class="icon"><i class="fas fa-landmark"></i></span> Contas</a></li>
            <li class="menu-item" id="menu-proventos">
                <div class="menu-parent"><span class="icon"><i class="fas fa-donate"></i></span> Proventos</div>
                <ul class="submenu">
                    <li><a data-tela="calendarioGeral"><span class="icon"><i class="fas fa-calendar-alt"></i></span> Calendário Pagamentos</a></li>
                    <li><a data-tela="calendarioAcoes"><span class="icon"><i class="fas fa-calendar-check"></i></span> Calendário Ações</a></li>
                    <li><a data-tela="proventos">Lançamentos</a></li>
                </ul>
            </li>
            <li class="menu-item"><a data-tela="metas"><span class="icon"><i class="fas fa-bullseye"></i></span> Metas</a></li>
            <li class="menu-item"><a data-tela="calculadoraIR"><span class="icon"><i class="fas fa-calculator"></i></span> Calculadora IR</a></li>
            <li class="menu-item" id="menu-lancamentos">
                <div class="menu-parent"><span class="icon"><i class="fas fa-edit"></i></span> Cadastros</div>
                <ul class="submenu">
                    <li><a data-tela="cadastroRF">Renda Fixa</a></li>
                    <li><a data-tela="cadastroContas">Contas</a></li>
                    <li><a data-tela="cadastroAtivos">Ativos (Renda Variável)</a></li>
                    <li><a data-tela="feriados">Feriados</a></li>
                    <li><a data-tela="posicaoInicial">Posição Inicial (RV)</a></li>
                </ul>
            </li>
            <li class="menu-item" id="menu-consultas">
                <div class="menu-parent"><span class="icon"><i class="fas fa-search"></i></span> Consultas</div>
                <ul class="submenu">
                    <li><a data-tela="posicaoCorretora">Posição por Instituição Financeira</a></li>
                    <li><a data-tela="historicoSnapshots"><span class="icon"><i class="fas fa-layer-group"></i></span> Histórico de Snapshots</a></li>
                    <li><a data-tela="posicoesZeradas">Posições Zeradas</a></li>
                    <li><a data-tela="historicoMovimentacao">Histórico de Movimentação</a></li>
                    <li><a data-tela="crescimentoPatrimonial">Crescimento Patrimonial</a></li>
                    <li><a data-tela="performanceRV"><span class="icon"><i class="fas fa-rocket"></i></span> Performance de Ativos RV</a></li>
                </ul>
            </li>
             <li class="menu-item" id="menu-ajustes">
                <div class="menu-parent"><span class="icon"><i class="fas fa-tools"></i></span> Ajustes</div>
                <ul class="submenu">
                    <li><a data-tela="ajustesTransferencia">Transferência</a></li>
                    <li><a data-tela="eventosAtivos">Eventos (Entrada/Saída)</a></li>
                    <li><a data-tela="eventosCorporativos">Split/Grupamento</a></li>
                    <li><a data-tela="ajustePM">Ajuste de Preço Médio</a></li>
                </ul>
            </li>
            <li class="menu-item config-item"><a data-tela="configuracoes"><span class="icon"><i class="fas fa-cog"></i></span> Configurações</a></li>
            <div id="user-info" style="display: none;">
                <span id="user-email"></span>
                <button id="btn-logout" class="btn btn-danger btn-sm">Sair</button>
            </div>
        </ul>
        <div class="sidebar-footer">
            <div class="footer-info" id="backup-info">
                <span>Último backup: Nunca</span>
            </div>
            <div class="footer-info" id="market-data-info">
                <span>Cotações: Nunca atualizado.</span>
            </div>
        </div>
    </nav>
    <main class="main-content">
        <div id="tela-caixa-global" style="display: none;">
            <div class="page-header">
                <h1 class="titulo-com-icone">
                    Todas as Contas
                    <i class="fas fa-calendar-week icone-titulo" id="btn-abrir-calendario-recorrentes-caixa" title="Ver Calendário de Recorrências"></i>
                    <i class="fas fa-chart-area icone-titulo" id="btn-abrir-projecao-caixa" title="Ver Projeção de Saldos Futuros"></i>
                </h1>
                <div class="page-header-filters">
                    <div class="form-group">
                        <label for="filtro-caixa-data-inicio">Início do Extrato</label>
                        <input type="date" id="filtro-caixa-data-inicio">
                    </div>
                    <div class="form-group">
                        <label for="filtro-caixa-data-fim">Extrato até</label>
                        <input type="date" id="filtro-caixa-data-fim">
                    </div>
                     <button class="btn btn-primary" id="btn-nova-transacao-universal">
                        <i class="fas fa-plus"></i> Nova Transação
                    </button>
                    <button class="btn btn-success" id="btn-adicionar-conta-universal" style="margin-left: 15px;">
                        <i class="fas fa-plus"></i> Adicionar Conta
                    </button>
                    <button class="btn btn-secondary" id="btn-backup-caixa">
                        <i class="fas fa-save"></i> Backup
                    </button>
                </div>
                <div class="filtros-container">
                    </div>
            </div>
            <div id="container-caixa-global">
                </div>
        </div>
        <div id="tela-calendario-geral" style="display: none;">
            <div class="page-header">
                <h1 id="titulo-calendario-geral">Calendário Geral de Rendimentos</h1>
                <div class="page-header-filters">
                    <div class="form-group">
                        <label for="calendario-geral-filtro-corretora">Filtrar por Corretora</label>
                        <select id="calendario-geral-filtro-corretora" class="broker-filter">
                            </select>
                    </div>
                </div>
            </div>
            <div id="container-calendario-geral">
                </div>
        </div>
        <div id="tela-negociar" style="display: none;">
            <div class="page-header">
                <h1>Análise de Cenários de Negociação</h1>
                <div class="page-header-actions">
                    <i class="fas fa-undo acao-btn" id="btn-reset-simulacao" title="Limpar e resetar simulação"></i>
                    <i class="fas fa-eye acao-btn" id="btn-visualizar-simulacao" title="Visualizar resumo da negociação"></i>
                    <i class="fas fa-file-invoice-dollar acao-btn" id="btn-criar-nota-simulacao" title="Criar Nota de Negociação a partir da Simulação"></i>
                </div>
                </div>
                <div class="container aporte-panel">
                    <div class="form-group aporte-input-group">
                        <label for="negociar-aporte-valor">Valor do Aporte (R$):</label>
                        <input type="text" id="negociar-aporte-valor" placeholder="Ex: 5.000,00">
                    </div>
                    <div class="aporte-summary">
                        <div class="summary-data-point">
                            <label>Total Compras FIIs:</label>
                            <span id="negociar-total-compras-fiis">R$ 0,00</span>
                        </div>
                        <div class="summary-data-point">
                            <label>Total Compras Ações:</label>
                            <span id="negociar-total-compras-acoes">R$ 0,00</span>
                        </div>
                        <div class="summary-data-point total">
                            <label>Saldo Disponível do Aporte:</label>
                            <span id="negociar-saldo-disponivel">R$ 0,00</span>
                        </div>
                    </div>
                </div>
        
            <div class="container trade-section">
                <h2>Fundos Imobiliários (FIIs)</h2>
                <div class="table-responsive">
                    <table class="trade-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Ativo</th>
                                <th rowspan="2" class="numero">Preço Médio</th>
                                <th rowspan="2" class="numero">Preço Atual</th>
                                <th rowspan="2" class="percentual col-variacao">Var. %</th>
                                <th colspan="2" class="group-header group-header-centered">P/VP</th>
                                <th rowspan="2" class="percentual">Yield Projetado</th> <th rowspan="2" class="numero">Posição (Qtd)</th>
                                <th rowspan="2" class="numero">Meta (Qtd)</th>
                                <th rowspan="2" class="numero">Diferença</th>
                                <th colspan="4" class="group-header group-header-centered">Simular Compra</th>
                                <th colspan="2" class="group-header group-header-centered">Projeção Rend.</th>
                            </tr>
                            <tr>
                                <th class="numero">Custo</th>
                                <th class="numero">Mercado</th>
                                <th class="numero">Qtd</th>
                                <th class="numero">Preço (R$)</th>
                                <th class="numero">Total (R$)</th>
                                <th class="numero">Pos. Final</th>
                                <th class="numero">Atual</th>
                                <th class="numero">Pós-Compra</th>
                            </tr>
                        </thead>
                        <tbody id="negociar-fiis-tbody">
                            </tbody>
                            <tfoot id="negociar-fiis-tfoot">
                                <tr>
                                    <td colspan="14" style="text-align: right;"><strong>TOTAIS DE RENDIMENTOS MENSAIS (FIIs):</strong></td>
                                    <td class="numero" id="total-rend-atual-fiis">R$ 0,00</td>
                                    <td class="numero" id="total-rend-pos-compra-fiis">R$ 0,00</td>
                                </tr>
                                <tr>
                                    <td colspan="14" style="text-align: right;"><strong>Acréscimo de Rendimento:</strong></td>
                                    <td colspan="2" class="numero" id="diff-rend-fiis">R$ 0,00</td>
                                </tr>
                            </tfoot>
                    </table>
                </div>
            </div>
        
            <div class="container trade-section">
                <h2>Ações</h2>
                <p class="info-nota-calculo">Nota: O Yield projetado para ações é baseado no histórico de dividendos dos últimos 5 anos.</p>
                <div class="table-responsive">
                    <table class="trade-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Ativo</th>
                                <th rowspan="2" class="numero">Preço Médio</th>
                                <th rowspan="2" class="numero">Preço Atual</th>
                                <th rowspan="2" class="numero">Var.%</th>
                                <th rowspan="2" class="col-price-range">Faixa Preço (52s)</th>
                                <th colspan="2" class="group-header group-header-centered">Preço Teto</th>
                                <th rowspan="2" class="numero">P/L</th>
                                <th rowspan="2" class="numero">Payout</th>
                                <th rowspan="2" class="percentual">Yield Projetado</th> <th rowspan="2" class="numero">Posição (Qtd)</th>
                                <th rowspan="2" class="numero">Meta (Qtd)</th>
                                <th rowspan="2" class="numero">Ajuste (qtd)</th>
                                <th colspan="4" class="group-header group-header-centered">Simular Compra</th>
                                <th colspan="2" class="group-header group-header-centered">Projeção Rend.</th>
                            </tr>
                            <tr>
                                <th class="numero">Bazin</th>
                                <th class="numero">Graham</th>
                                <th class="numero">Qtd</th>
                                <th class="numero">Preço (R$)</th>
                                <th class="numero">Total (R$)</th>
                                <th class="numero">Pos. Final</th>
                                <th class="numero">Atual</th>
                                <th class="numero">Pós-Compra</th>
                            </tr>
                        </thead>
                        <tbody id="negociar-acoes-tbody">
                            </tbody>
                            <tfoot id="negociar-acoes-tfoot">
                                <tr>
                                    <td colspan="17" style="text-align: right;"><strong>TOTAIS DE RENDIMENTOS MENSAIS (Ações):</strong></td>
                                    <td class="numero" id="total-rend-atual-acoes">R$ 0,00</td>
                                    <td class="numero" id="total-rend-pos-compra-acoes">R$ 0,00</td>
                                </tr>
                                <tr>
                                    <td colspan="17" style="text-align: right;"><strong>Acréscimo de Rendimento:</strong></td>
                                    <td colspan="2" class="numero" id="diff-rend-acoes">R$ 0,00</td>
                                </tr>
                            </tfoot>
                    </table>
                </div>
            </div>
        </div>
        <div id="tela-calendario-acoes" style="display: none;">
            <div class="page-header">
                <h1>Calendário de Proventos de Ações</h1>
                <div class="page-subheader" id="seletor-vista-calendario-acoes">
                    <h2 id="subtitulo-datacom" class="subtitulo-calendario ativo" data-vista="dataCom">Data-Com</h2>
                    <h2 id="subtitulo-datapagamento" class="subtitulo-calendario" data-vista="dataPagamento">Data Pagamento</h2>
                </div>
            </div>
            <div class="container" id="calendario-acoes-container">
                </div>
        </div>
        <div id="tela-eventos-ativos" style="display: none;">
            <div class="page-header">
                <h1>Eventos de Ativos (Entradas e Saídas não comerciais)</h1>
                <div>
                    <button class="btn btn-primary" id="btn-novo-evento-ativo">Registrar Novo Evento</button>
                </div>
            </div>
            <div class="container">
                <p>Use esta seção para registrar entradas (ex: bonificação, herança, doação recebida) ou saídas (ex: doação realizada) de ativos que não envolvem uma operação de compra ou venda no mercado.</p>
            </div>
            <div class="container" id="lista-de-eventos-ativos">
                </div>
        </div>
        <div id="tela-historico-snapshots" style="display: none;">
            <div class="page-header">
                <h1>Histórico de Snapshots da Carteira</h1>
                <div id="snapshot-currency-filter" class="page-header-filters">
                    <form class="radio-group" style="background-color: transparent; border: none; padding: 0;">
                        <label>Exibir em:</label>
                        <input type="radio" id="snap-brl" name="snapshot-currency" value="BRL" checked>
                        <label for="snap-brl">BRL</label>
                        <input type="radio" id="snap-gbp" name="snapshot-currency" value="GBP">
                        <label for="snap-gbp">GBP</label>
                        <input type="radio" id="snap-eur" name="snapshot-currency" value="EUR">
                        <label for="snap-eur">EUR</label>
                        <input type="radio" id="snap-usd" name="snapshot-currency" value="USD">
                        <label for="snap-usd">USD</label>
                    </form>
                </div>
            </div>
            <div class="container" id="container-historico-snapshots">
                </div>
        </div>
        <div id="tela-posicao-corretora" style="display: none;">
            <div class="page-header">
                <h1>Posição Consolidada por Instituição Financeira</h1>
            </div>
            <div id="container-posicao-por-corretora">
                </div>
        </div>
        <div id="tela-consulta-balanceamento" style="display: none;">
            <div class="page-header">
                <h1>Plano de Ação e Rebalanceamento</h1>
                <div> <i class="fas fa-print fa-lg acao-btn" id="btn-imprimir-balanceamento" title="Imprimir Plano de Ação" style="margin-right: 20px;"></i>
                    <button class="btn btn-success" id="btn-levar-plano-para-negociar" title="Leva as sugestões de compra e venda para a tela de simulação">
                        <i class="fas fa-arrow-right"></i> Simular este Plano
                    </button>
                </div>
            </div>
            <div id="container-alerta-concentracao" class="container" style="display: none; padding: 10px;">
                </div>
            <div id="container-consulta-balanceamento">
                </div>
        </div>
        <div id="tela-eventos-corporativos" style="display: none;">
            <div class="page-header">
                <h1>Ajustes de Posição (Split/Grupamento)</h1>
                <div>
                    <button class="btn btn-primary" id="btn-novo-evento-corporativo">Registrar Novo Evento</button>
                </div>
            </div>
             <div class="container">
                <p>Use esta seção para registrar desdobramentos (splits) ou grupamentos (inplits) de ativos. Estes eventos alteram a quantidade de ativos e o preço médio, mas não o valor total investido.</p>
            </div>
            <div class="container" id="lista-de-eventos-corporativos">
                </div>
        </div>
        <div id="tela-metas" style="display: none;">
            <div class="page-header">
                <h1>Painel de Metas</h1>
                <button class="btn btn-primary" onclick="abrirModalCadastroMeta()"><i class="fas fa-plus"></i> Adicionar Nova Meta</button>
            </div>
            <div id="container-metas" class="metas-grid">
                </div>
        </div>
        <div id="tela-dashboard" style="display: none;">
            <div class="page-header">
                <h1 class="titulo-com-icone">
                    <span>Dashboard Financeiro</span>
                </h1>
                <div class="page-header-filters">
                    <button class="btn btn-danger" id="btn-sync-needed-alert" title="Sincronização recomendada! Clique para ir à ferramenta." style="display: none;">
                        <i class="fas fa-exclamation"></i> Sincronizar
                    </button>
                    <button class="btn btn-success" id="btn-atualizar-cotacoes-api"><i class="fas fa-sync-alt"></i> Atualizar Cotações (Auto)</button>
                    <button class="btn btn-primary" id="btn-salvar-snapshot-carteira" title="Salva o valor atual da carteira de investimentos para o gráfico de evolução"><i class="fas fa-camera"></i> Salvar Snapshot da Carteira</button>
                    <button class="btn btn-purple" id="btn-dashboard-backup"><i class="fas fa-save"></i> Fazer Backup</button>
                    <button class="btn btn-purple btn-restaurar-backup"><i class="fas fa-upload"></i> Restaurar Backup</button>
                </div>
            </div>
            <div class="dashboard-alert" id="dashboard-alerta-rebalanceamento" style="display: none;">
                <i class="fas fa-balance-scale-right"></i>
                <span><strong>Oportunidade de Rebalanceamento!</strong> Existem ativos em sua carteira prontos para serem vendidos com lucro para rebalancear a alocação.</span>
                <a href="#" data-tela="consultaBalanceamento" class="link-alerta">Verificar agora</a>
            </div>
            <div id="dashboard-ticker-tape" class="ticker-tape-container">
                <div class="ticker-tape-content">
                    </div>
            </div>
            <div id="dashboard-summary-cards" class="summary-cards">
                <div class="summary-card">
                    <div class="card-title">
                        <span>Patrimônio Total</span>
                    </div>
                    <div class="card-value" id="db-patrimonio-total">R$ 0,00</div>
                </div>
                <div id="card-investimentos" class="summary-card">
                    <div class="card-title">Carteira de Investimentos</div>
                    <div class="card-value" id="db-carteira-total">R$ 0,00</div>
                </div>
                <div id="card-contas" class="summary-card">
                    <div class="card-title">Saldo em Contas</div>
                    <div class="card-value" id="db-contas-total">R$ 0,00</div>
                </div>
                <div id="card-moedas" class="summary-card">
                    <div class="card-title">Moedas Estrangeiras</div>
                    <div class="card-value" id="db-moedas-total">R$ 0,00</div>
                </div>
                <div id="card-proventos" class="summary-card">
                    <div class="card-title">Proventos Provisionados</div>
                    <div class="card-value" id="db-proventos-provisionados-total">R$ 0,00</div>
                </div>
            </div>
            <div class="container" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 30px;">
                <div class="grafico-container" style="flex: 1; min-width: 400px;">
                    <canvas id="grafico-alocacao-canvas"></canvas>
                </div>  

                <div style="flex: 1.5; min-width: 500px;">
                    <h3>Resumo e Alocação da Carteira</h3>
                    <h4 class="subtitulo-dashboard" id="data-inicio-carteira"></h4>
                    <div id="dashboard-table-container"></div>
                    
                    <div id="dashboard-alocacao-panel" style="margin-top: 20px;">
                        <h4>Definir Alocação Ideal</h4>
                        <div id="dashboard-alocacao-container" class="dashboard-alocacao-grid"></div>
                        <div id="dashboard-alocacao-total" class="dashboard-alocacao-total"></div>
                    </div>
                </div>
            </div>

            <div id="dashboard-metas-summary-container" class="container" style="display: none;">
                </div>
            <div class="container">
                <h3>Evolução da Carteira de Investimentos</h3>
                <div class="grafico-barras-container">
                    <canvas id="grafico-carteira-canvas"></canvas>
                </div>
            </div>
            <div class="container">
                <h3>Evolução de Proventos Recebidos (Renda Variável)</h3>
                <div class="grafico-barras-container">
                    <canvas id="grafico-proventos-canvas"></canvas>
                </div>
            </div>
            <div class="container">
                <div class="grafico-header-com-toggle">
                    <h3>Aportes Externos vs. Proventos Gerados</h3>
                    <div class="chart-toggle-container" id="toggle-aportes-grafico">
                        <button class="chart-toggle-btn ativo" data-tipo="barras">
                            <i class="fas fa-chart-bar"></i> Composição
                        </button>
                        <button class="chart-toggle-btn" data-tipo="linhas">
                            <i class="fas fa-chart-line"></i> Ponto de Virada
                        </button>
                    </div>
                </div>
                <div class="grafico-barras-container">
                    <canvas id="grafico-aportes-proventos-canvas"></canvas>
                </div>
            </div>
            <div class="container">
                <h3>Análise de Rentabilidade Real (Renda Variável)</h3>
                <div class="chart-period-controls" style="display: flex; justify-content: left; gap: 5px; margin-bottom: 10px;">
                    <input type="radio" id="dash-periodo-1m" name="periodo-desempenho-dash" value="1M">
                    <label for="dash-periodo-1m" class="chart-period-btn">1M</label>
                
                    <input type="radio" id="dash-periodo-ytd" name="periodo-desempenho-dash" value="YTD">
                    <label for="dash-periodo-ytd" class="chart-period-btn">YTD</label>
                
                    <input type="radio" id="dash-periodo-1a" name="periodo-desempenho-dash" value="1A">
                    <label for="dash-periodo-1a" class="chart-period-btn">1A</label>
                
                    <input type="radio" id="dash-periodo-5a" name="periodo-desempenho-dash" value="5A">
                    <label for="dash-periodo-5a" class="chart-period-btn">5A</label>
                </div>
                <div class="grafico-barras-container">
                    <canvas id="grafico-desempenho-canvas"></canvas>
                </div>
            </div>
            <div class="container" id="painel-comparativo-container" style="display: none;">
                </div>
            </div>
            <div id="tela-cadastro-rf" style="display: none;">
            <div class="page-header">
                <h1>Cadastro de Aplicações em Renda Fixa</h1>
                <div>
                    <button class="btn btn-primary btn-abrir-modal-rf" id="btn-cadastrar-novo-ativo-rf-cadastro">Nova Aplicação</button>
                    <button class="btn btn-danger" id="btn-excluir-todos-ativos-rf">Excluir Todas</button>
                </div>
            </div>
            <div class="container" id="lista-de-ativos-rf">
                </div>
        </div>
        <div id="tela-renda-fixa" style="display: none;">
            <div class="page-header">
                <h1>Minha Posição em Renda Fixa</h1>
                <div class="page-header-filters">
                    <button class="btn btn-primary btn-abrir-modal-rf" id="btn-cadastrar-novo-ativo-rf">Nova Aplicação</button>
                    <div class="form-group">
                        <label>Posição em</label><input type="date" class="date-filter" data-tipo-ativo="RendaFixa">
                    </div>
                </div>
            </div>
            <div class="page-header-summary" id="summary-rf">
                 </div>
            <div class="container" id="posicao-rf-container">
                 </div>
        </div>
        <div id="tela-historico-movimentacao" style="display: none;">
            <div class="page-header">
                <h1>Histórico de Movimentação por Ativo</h1>
            </div>
            <div class="container">
                <form id="form-busca-historico" class="form-row" style="align-items: flex-end;">
                    <div class="form-group" style="flex-grow: 3;">
                        <label for="select-ativo-historico">Selecione o Ativo</label>
                        <select id="select-ativo-historico" required>
                            <option value="">Selecione um ativo...</option>
                        </select>
                    </div>
                </form>
                <div id="container-tabela-movimentacoes" style="margin-top: 20px;">
                    </div>
            </div>
        </div>
        <div id="tela-crescimento-patrimonial" style="display: none;">
            <div class="page-header">
                <h1>Crescimento do Patrimônio por Valor/Tempo</h1>
            </div>
            <div class="container">
                <p>Esta ferramenta analisa o histórico de snapshots da sua carteira. Escolha o tipo de análise desejada.</p>
                <form id="form-crescimento-patrimonial" class="form-row" style="align-items: flex-end; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                    <div class="form-group" style="flex-grow: 1;">
                        <label for="crescimento-tipo-saldo">Tipo de Saldo para Análise</label>
                        <select id="crescimento-tipo-saldo" required>
                            <option value="patrimonioTotal">Patrimônio Total</option>
                            <option value="valorTotalInvestimentos">Total Investimentos</option>
                            <option value="FIIs">Apenas FIIs</option>
                            <option value="Ações">Apenas Ações</option>
                            <option value="ETF">Apenas ETFs</option>
                            <option value="Renda Fixa">Apenas Renda Fixa</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex-grow: 1;">
                        <label for="crescimento-tipo-analise">Tipo de Análise</label>
                        <select id="crescimento-tipo-analise" required>
                            <option value="valor">Por Valor (Marcos de Crescimento)</option>
                            <option value="periodo">Por Período (Performance)</option>
                        </select>
                    </div>
        
                    <div id="container-analise-valor" class="form-group">
                        <label for="crescimento-intervalo-valor">Intervalo de Crescimento (R$)</label>
                        <input type="text" id="crescimento-intervalo-valor" placeholder="Ex: 10000">
                    </div>
        
                    <div id="container-analise-periodo" class="form-group" style="display: none; flex-grow: 2;">
                        <div class="form-row" style="margin-bottom: 0; width: 100%;">
                            <div class="form-group">
                                <label for="crescimento-periodo">Período</label>
                                <select id="crescimento-periodo">
                                    <option value="semanal">Semanal</option>
                                    <option value="mensal">Mensal</option>
                                    <option value="trimestral">Trimestral</option>
                                    <option value="semestral">Semestral</option>
                                    <option value="anual">Anual</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="crescimento-data-inicio">A partir de</label>
                                <input type="date" id="crescimento-data-inicio">
                            </div>
                        </div>
                    </div>
        
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Analisar Crescimento</button>
                    </div>
                </form>
            </div>
            <div class="container" id="container-resultado-crescimento" style="display: none;">
            </div>
        </div>
        <div id="tela-posicoes-zeradas" style="display: none;">
            <div class="page-header">
                <h1>Consulta a Posições Zeradas</h1>
            </div>
            <div class="container">
                <p>Abaixo estão listados os ativos que já fizeram parte da sua carteira, mas cuja posição atual é zero.</p>
                <div id="container-posicoes-zeradas"></div>
            </div>
        </div>
        <div id="tela-calculadora-ir" style="display: none;">
            <div class="page-header">
                <h1>Calculadora de Imposto de Renda</h1>
                <div class="page-header-filters">
                    <div class="form-group">
                        <label for="ir-filtro-ano">Ano</label>
                        <select id="ir-filtro-ano"></select>
                    </div>
                    <i class="fas fa-print fa-lg acao-btn icone-titulo" id="btn-imprimir-ir" title="Imprimir Relatório para IR"></i>
                </div>
            </div>
            <div class="container">
                <h2>I.R. a Pagar no Ano: <span id="ir-total-anual">R$ 0,00</span></h2>
            </div>
            <div class="container">
                <h3>FIIs/FIAGROS</h3>
                <div id="ir-tabela-fiis"></div>
            </div>
            <div class="container">
                <h3>Geral (Ações, ETFs, etc.) - SWING TRADE</h3>
                <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">Vendas de Ações (ON/PN) até <strong id="ir-limite-isencao-texto">R$ 20.000,00</strong> no mês são isentas. Lucros de Ações (Units) e ETFs são sempre tributáveis. Prejuízos de qualquer um podem abater lucros tributáveis de qualquer outro dentro deste grupo.</p>
                <div id="ir-tabela-geral-rv"></div>
            </div>
             <div class="container">
                <h3>OPERAÇÕES DAY TRADE</h3>
                <div id="ir-tabela-daytrade"></div>
            </div>
        </div>
        <div id="tela-feriados" style="display: none;">
            <div class="page-header">
                <h1>Cadastro de Feriados</h1>
                <div>
                    <button class="btn btn-primary" id="btn-novo-feriado" style="margin-right: 10px;">Cadastrar Novo Feriado</button>
                    <button class="btn btn-danger" id="btn-excluir-todos-feriados">Excluir Todos</button>
                </div>
            </div>
            <div class="container" id="lista-de-feriados"></div>
        </div>
        <div id="tela-cadastro-contas" style="display: none;">
            <div class="page-header">
                <h1>Cadastro de Contas</h1>
                <div>
                    <button class="btn btn-primary" id="btn-nova-conta" style="margin-right: 10px;">Cadastrar Nova Conta</button>
                </div>
            </div>
            <div class="container" id="lista-de-contas-cadastradas"></div>
        </div>
        <div id="tela-lista-notas" style="display: none;">
            <div class="page-header">
                <h1>Notas de Negociação Lançadas</h1>
                <div class="page-header-filters">
                    <div class="form-group">
                        <label for="filtro-nota-ativo">Filtrar por Ativo</label>
                        <input type="text" id="filtro-nota-ativo" placeholder="Digite o ticker..." class="ticker-input">
                    </div>
                </div>
                <div>
                    <button class="btn btn-primary" id="btn-novo-lancamento">Novo Lançamento</button>
                    <input type="file" id="input-arquivo-notas" accept=".csv" style="display: none;">
                    <button class="btn btn-secondary" id="btn-importar-notas-csv"><i class="fas fa-file-csv"></i> Importar Notas (CSV)</button>
                    <button class="btn btn-danger" id="btn-excluir-todas-notas">Excluir Todas</button>
                </div>
            </div>
            <div class="container" id="lista-de-notas-salvas"></div>
        </div>
        <div id="tela-importacao-notas" style="display: none;">
            <div class="page-header">
                <h1>Revisão de Notas Importadas</h1>
                <p>Verifique os dados importados. Você pode fazer ajustes antes de salvar permanentemente.</p>
            </div>
            <div id="container-revisao-notas"></div>
            <div class="form-actions" style="padding: 20px; border-top: 1px solid #ccc; margin-top: 20px;">
                <button type="button" class="btn btn-secondary" id="btn-cancelar-importacao-notas">Cancelar Importação</button>
                <button type="button" class="btn btn-success" id="btn-salvar-notas-importadas">Salvar Todas as Notas Importadas</button>
            </div>
        </div>
        <div id="tela-lancamento-nota" style="display: none;">
            <h1>Lançamento de Nota de Negociação</h1>
            <div class="container">
                <form id="form-nota-geral"><div class="form-grid"><div class="form-group"><label for="nota-corretora">Corretora</label><select id="nota-corretora" required></select></div><div class="form-group"><label for="nota-numero">Número da Nota</label><input type="text" id="nota-numero" required></div><div class="form-group"><label for="nota-data">Data da Nota</label><input type="date" id="nota-data" required></div><div class="form-group"><label for="nota-custos">Custos Totais</label><input type="text" id="nota-custos" placeholder="0,00"></div><div class="form-group"><label for="nota-irrf">IRRF</label><input type="text" id="nota-irrf" placeholder="0,00"></div></div></form>
                <form id="form-add-operacao" class="form-operacao"><h3>Adicionar Operação</h3><div class="form-grid"><div class="form-group"><label for="op-ativo">Ativo</label><input type="text" id="op-ativo" placeholder="ex: PETR4" required class="ticker-input"></div><div class="form-group"><label for="op-tipo">Operação</label><select id="op-tipo"><option value="compra">Compra</option><option value="venda">Venda</option></select></div><div class="form-group"><label for="op-quantidade">Quantidade</label><input type="number" id="op-quantidade" step="1" required></div><div class="form-group"><label for="op-valor">Valor Total (R$)</label><input type="text" id="op-valor" placeholder="0,00" required></div><div class="form-group" style="justify-content: flex-end;"><button type="submit" class="btn btn-primary">Adicionar</button></div></div></form>
            </div>
            <div class="container">
                <h2>Operações na Nota</h2>
                <table><thead><tr><th>Ativo</th><th>Operação</th><th class="numero">Qtd</th><th class="numero">Preço Unit.</th><th class="numero">Valor Total</th><th class="numero">Preço c/ Custos</th><th class="controles-col">Controles</th></tr></thead><tbody id="tabela-operacoes-body"></tbody></table>
                 <div class="subtotal-nota">
                    <h3>Resumo da Nota</h3>
                    <div class="subtotal-grid">
                        <div class="subtotal-item"><span>Total Compras:</span><span id="subtotal-compras">R$ 0,00</span></div>
                        <div class="subtotal-item"><span>Total Vendas:</span><span id="subtotal-vendas">R$ 0,00</span></div>
                        <div class="subtotal-item"><span>Custos + IRRF:</span><span id="subtotal-custos">R$ 0,00</span></div>
                        <div class="subtotal-item valor-liquido"><span>Valor Líquido:</span><span id="subtotal-liquido">0,00C</span></div>
                        <div class="subtotal-item"><span>Data de Liquidação:</span><span id="subtotal-liquidacao">--/--/----</span></div>
                    </div>
                </div>
                <div class="form-actions"><button type="button" class="btn btn-secondary" id="btn-cancelar-nota">Cancelar</button><button type="button" class="btn btn-success" id="btn-salvar-nota">Salvar Nota</button></div>
            </div>
        </div>
        <div id="tela-cadastro-ativos" style="display: none;">
            <div class="page-header">
                <h1>Cadastro de Ativos (Renda Variável)</h1>
                <div id="botoes-ativos-padrao">
                    <button class="btn btn-secondary" id="btn-buscar-ativos-nao-cadastrados">Analisar Cadastros</button>
                    <button class="btn btn-primary" id="btn-cadastrar-novo-ativo">Cadastrar Novo Ativo</button>
                    <button class="btn btn-secondary" id="btn-edicao-rapida-ativos">Edição Rápida</button>
                    <button class="btn btn-danger" id="btn-excluir-todos-ativos">Excluir Todos</button>
                </div>
                <div id="botoes-ativos-edicao" style="display: none;">
                    <button class="btn btn-success" id="btn-salvar-edicao-rapida-ativos">Salvar Alterações</button>
                    <button class="btn btn-secondary" id="btn-cancelar-edicao-rapida-ativos">Cancelar</button>
                </div>
            </div>
            <div class="container" id="lista-de-ativos-cadastrados"></div>
        </div>
        <div id="tela-posicao-inicial" style="display: none;">
             <div class="page-header">
                <h1>Posição Inicial de Renda Variável</h1>
                <div>
                    <button class="btn btn-primary" id="btn-adicionar-posicao-massa">Adicionar Posição em Massa</button>
                    <button class="btn btn-secondary" id="btn-add-historico-ativo">Adicionar Histórico (Manual)</button>
                    <input type="file" id="input-arquivo-historico" accept=".csv" style="display: none;">
                    <button class="btn btn-secondary" id="btn-importar-historico-csv"><i class="fas fa-file-csv"></i> Importar Histórico (CSV)</button>
                    <button class="btn btn-danger" id="btn-excluir-todas-posicoes">Excluir Todas</button>
                </div>
            </div>
            <div class="container" id="lista-de-posicoes-iniciais"></div>
            <div id="container-adicionar-historico" class="container" style="display: none;">
                <h2>Adicionar Histórico de Ativo (Manual)</h2>
                <form id="form-buscar-ativo-historico" class="form-row" style="align-items: flex-end;">
                    <div class="form-group">
                        <label for="historico-ativo-ticker">Ativo</label>
                        <input type="text" id="historico-ativo-ticker" class="ticker-input" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Buscar Ativo</button>
                    </div>
                </form>
                <div id="container-tabela-historico" style="display: none;">
                    <h3>Lançamentos para o ativo: <span id="historico-ativo-selecionado"></span></h3>
                    <form id="form-salvar-historico">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Transação</th>
                                    <th class="numero">Quantidade</th>
                                    <th>Corretora</th>
                                    <th class="numero">Preço Médio Resultante</th>
                                    <th class="controles-col">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-historico-body">
                            </tbody>
                        </table>
                        <div class="form-actions" style="justify-content: space-between; margin-top: 20px;">
                             <button type="button" class="btn btn-primary" id="btn-add-linha-historico"><i class="fas fa-plus"></i> Adicionar Linha</button>
                             <div>
                                <button type="button" class="btn btn-secondary" id="btn-cancelar-historico">Cancelar</button>
                                <button type="submit" class="btn btn-success">Salvar Histórico</button>
                             </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="tela-posicao-inicial-massa" style="display: none;">
            <div class="page-header">
                <h1>Lançamento em Massa da Posição Inicial</h1>
                <div>
                    <button type="button" class="btn btn-secondary" id="btn-voltar-lista-posicao">Voltar para a Lista</button>
                    <button type="button" class="btn btn-success" id="btn-salvar-posicao-massa">Salvar Posições</button>
                </div>
            </div>

            <div class="container">
                <p>Preencha os dados abaixo. Cada linha representa a posição de um ativo em uma corretora. Linhas com campos vazios ou com ticker não cadastrado serão ignoradas.</p>
                <form id="form-posicao-massa">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Ativo (Ticker)</th>
                                    <th style="width: 15%;">Data Posição</th>
                                    <th style="width: 25%;">Preço Médio (R$)</th>
                                    <th style="width: 15%;">Quantidade</th>
                                    <th style="width: 25%;">Corretora</th>
                                    <th style="width: 5%;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabela-posicao-massa-body">
                                </tbody>
                        </table>
                    </div>
                    <div class="form-actions" style="justify-content: flex-start; margin-top: 20px;">
                        <button type="button" class="btn btn-primary" id="btn-add-5-linhas-posicao">+ Adicionar 5 Linhas</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="tela-proventos-massa" style="display: none;">
            <div class="page-header">
                <h1>Lançamento em Massa de Proventos</h1>
                <div>
                    <button type="button" class="btn btn-secondary" id="btn-voltar-lista-proventos">Voltar para a Lista</button>
                    <button type="button" class="btn btn-success" id="btn-salvar-proventos-massa">Salvar Todos os Proventos</button>
                </div>
            </div>
        
            <div class="container">
                <p>Preencha os dados abaixo. Linhas com campos obrigatórios vazios ou com ticker não cadastrado serão ignoradas. O sistema calculará automaticamente o valor total e o YOC com base na sua posição na "Data Com".</p>
                <form id="form-proventos-massa">
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 12%;">Ativo (Ticker)</th>
                                    <th style="width: 15%;">Tipo</th>
                                    <th style="width: 15%;">Data Com</th>
                                    <th style="width: 15%;">Data Pagamento</th>
                                    <th style="width: 20%;" class="numero">Valor Bruto Unitário (R$)</th>
                                    <th style="width: 15%;" class="numero">IR (%)</th>
                                    <th style="width: 8%;"></th>
                                </tr>
                            </thead>
                            <tbody id="tabela-proventos-massa-body">
                                </tbody>
                        </table>
                    </div>
                    <div class="form-actions" style="justify-content: flex-start; margin-top: 20px;">
                        <button type="button" class="btn btn-primary" id="btn-add-5-linhas-provento">+ Adicionar 5 Linhas</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="tela-importacao-historico" style="display: none;">
            <div class="page-header">
                <h1>Revisão de Histórico Importado</h1>
                <p>Verifique os dados importados. Você pode fazer ajustes antes de salvar permanentemente.</p>
            </div>
            <div id="container-revisao-historico"></div>
            <div class="form-actions" style="padding: 20px; border-top: 1px solid #ccc; margin-top: 20px;">
                <button type="button" class="btn btn-secondary" id="btn-cancelar-importacao-historico">Cancelar Importação</button>
                <button type="button" class="btn btn-success" id="btn-salvar-historico-importado">Salvar Histórico Importado</button>
            </div>
        </div>
        <div id="tela-configuracoes" style="display: none;">
            <div class="page-header"><h1>Configurações</h1></div>
            <div class="container">
                <h2>Dados do Usuário</h2>
                <div class="form-group">
                    <label for="config-user-name">Seu Nome (para identificação na exportação)</label>
                    <input type="text" id="config-user-name" placeholder="Digite seu nome ou apelido">
                </div>
            </div>
            <div class="container">
                <h2>Parâmetros Gerais</h2>
                <div class="form-group">
                    <label for="config-salario-minimo">Valor do Salário Mínimo (R$)</label>
                    <input type="text" id="config-salario-minimo" placeholder="Ex: 1.512,00">
                </div>
            </div>
            <div class="container">
                <h2>Backup e Restauração / Exportação e Importação</h2>
                <p style="margin-bottom: 20px;">
                    <b>Backup:</b> Salve ou restaure TODOS os dados da aplicação (incluindo notas, proventos, transações, etc.).<br>
                    <b>Exportação:</b> Salve ou importe apenas os DADOS DE CADASTRO (Ativos, Contas e Feriados) em um arquivo CSV.
                </p>
                <div class="form-actions" style="justify-content: flex-start; gap: 15px;">
                    <button class="btn btn-primary" id="btn-backup">Fazer Backup Completo (.json)</button>
                    <button class="btn" id="btn-restaurar">Restaurar Backup (.json)</button>
                    <button class="btn btn-success" id="btn-exportar-cadastros">Exportar Cadastros (.csv)</button>
                    <button class="btn btn-secondary" id="btn-importar-cadastros">Importar Cadastros (.csv)</button>
                </div>
            </div>
            <div class="ajustes-section">
                <h2>Automação e Importação de Cotações</h2>
                <p style="margin-bottom: 15px;">Cole aqui o link público da sua planilha Google Sheets (publicada como CSV). O botão "Atualizar Cotações" no Dashboard usará este link.</p>
                <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <input type="checkbox" id="config-auto-update-toggle" style="width: auto;">
                    <label for="config-auto-update-toggle" style="margin: 0;">Ativar atualização automática de cotações a cada 10 minutos.</label>
                </div>
                <div class="form-group">
                    <label for="config-cotacoes-url">URL da Planilha de Cotações (Publicada como CSV)</label>
                    <div class="form-row" style="align-items: center; margin-bottom: 0;">
                        <input type="url" id="config-cotacoes-url" placeholder="https://docs.google.com/spreadsheets/d/.../export?format=csv" style="flex-grow: 1;">
                        <button type="button" class="btn btn-primary" id="btn-testar-salvar-url-cotacoes" style="margin-left: 10px;">Testar e Salvar URL</button>
                    </div>
                </div>
                <hr style="margin: 20px 0;">
                <p style="margin-bottom: 15px;">Para uma atualização manual, use o botão abaixo para importar um arquivo CSV do seu computador.</p>
                <div class="form-actions" style="justify-content: flex-start;">
                    <button class="btn btn-success" id="btn-baixar-cotacoes-link"><i class="fas fa-download"></i> Baixar Modelo CSV</button>
                    <button class="btn btn-secondary" id="btn-importar-cotacoes-manual-config"><i class="fas fa-file-csv"></i> Importar Cotações (CSV Manual)</button>
                </div>
            </div>
            <div class="container">
                <h2>Links Externos para Consulta</h2>
                <p style="margin-bottom: 20px;">Defina a URL base para consulta de ativos. O sistema adicionará o ticker ao final do link (Ex: https://statusinvest.com.br/acoes/PETR4).</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="config-link-acoes">URL para Ações</label>
                        <input type="url" id="config-link-acoes" placeholder="https://exemplo.com/acoes/">
                    </div>
                    <div class="form-group">
                        <label for="config-link-fiis">URL para FIIs</label>
                        <input type="url" id="config-link-fiis" placeholder="https://exemplo.com/fiis/">
                    </div>
                    <div class="form-group">
                        <label for="config-link-etfs">URL para ETFs</label>
                        <input type="url" id="config-link-etfs" placeholder="https://exemplo.com/etfs/">
                    </div>
                </div>
            </div>
            <div class="container config-section">
                <h2 id="titulo-parametros-fiscais">Parâmetros Fiscais e de Tributação</h2>
                <p style="margin-bottom: 20px;">Ajuste as alíquotas e limites usados nos cálculos do sistema. Os valores padrão serão usados se nenhum valor for salvo.</p>
                <form id="form-config-fiscal">
                    <div id="config-ir-variavel">
                        <h4>Renda Variável</h4>
                        <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                            <div class="form-group">
                                <label for="config-aliquota-swing">Alíquota Swing Trade (Ações/ETFs) (%)</label>
                                <input type="text" id="config-aliquota-swing" placeholder="15,00">
                            </div>
                            <div class="form-group">
                                <label for="config-aliquota-daytrade">Alíquota Day Trade e FIIs (%)</label>
                                <input type="text" id="config-aliquota-daytrade" placeholder="20,00">
                            </div>
                            <div class="form-group">
                                <label for="config-limite-isencao">Limite Isenção Venda de Ações (R$)</label>
                                <input type="text" id="config-limite-isencao" placeholder="20.000,00">
                            </div>
                        </div>
                    </div>
                    <div id="config-ir-fixa">
                        <h4>Renda Fixa (Tabela Regressiva)</h4>
                        <div class="form-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="form-group"><label>Até 180 dias (%)</label><input type="text" class="config-ir-fixa-faixa" data-faixa="180" placeholder="22,50"></div>
                            <div class="form-group"><label>De 181 a 360 dias (%)</label><input type="text" class="config-ir-fixa-faixa" data-faixa="360" placeholder="20,00"></div>
                            <div class="form-group"><label>De 361 a 720 dias (%)</label><input type="text" class="config-ir-fixa-faixa" data-faixa="720" placeholder="17,50"></div>
                            <div class="form-group"><label>Acima de 720 dias (%)</label><input type="text" class="config-ir-fixa-faixa" data-faixa="9999" placeholder="15,00"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="container config-section">
                <h2>Manutenção de Dados</h2>
                <p style="margin-bottom: 20px;">Use esta ferramenta para uma verificação profunda. Ela irá recalcular todos os proventos, sincronizar os lançamentos de caixa de proventos e notas, e buscar por ativos ainda não cadastrados. Use após alterações no histórico.</p>
                <div class="form-actions" style="justify-content: flex-start;">
                    <button class="btn btn-primary" id="btn-sincronizar-registros">Recalcular e Sincronizar Registos</button>
                </div>
            </div>
            <div class="container config-section">
                <h2>Verificação de Inconsistências</h2>
                <p style="margin-bottom: 20px;">Use esta ferramenta para procurar por possíveis erros de lançamento ou cadastros incompletos que possam afetar os cálculos da carteira.</p>
                <div class="form-actions" style="justify-content: flex-start;">
                    <button class="btn" id="btn-verificar-inconsistencias">Verificar Inconsistências Agora</button>
                </div>
                <div id="resultados-inconsistencias" style="margin-top: 20px;"></div>
            </div>
            <div class="container config-section">
                <h2>Zona de Perigo</h2>
                <p style="margin-bottom: 20px;">A ação nesta seção é irreversível. Tenha certeza absoluta antes de prosseguir.</p>
                <button class="btn btn-danger" id="btn-apagar-tudo">Apagar Todos os Dados</button>
            </div>
        </div>
        <div id="tela-ajustes-transferencia" style="display: none;">
            <div class="page-header"><h1>Ajustes de Posição</h1></div>
            <div class="container">
                <h2 id="transferencia-form-titulo">Registrar Nova Transferência de Custódia</h2>
                <p>Use esta ferramenta para registrar a movimentação de ativos entre corretoras.</p>
                <form id="form-transferencia-custodia">
                    <input type="hidden" id="transferencia-id">
                    <div class="form-row">
                        <div class="form-group"><label for="transferencia-corretora-origem">Corretora de Origem</label><select id="transferencia-corretora-origem" required><option value="">Selecione...</option></select></div>
                        <div class="form-group"><label for="transferencia-corretora-destino">Corretora de Destino</label><select id="transferencia-corretora-destino" required><option value="">Selecione...</option></select></div>
                        <div class="form-group"><label for="transferencia-data">Data da Transferência</label><input type="date" id="transferencia-data" required></div>
                    </div>
                    <div id="transferencia-ativos-container" style="display: none;">
                        <h4 style="margin-top: 15px;">Selecione os Ativos e as Quantidades a Transferir</h4>
                        <div id="transferencia-ativos-disponiveis" style="margin-top: 15px;"></div>
                        <h4 style="margin-top: 25px;">Selecione os Proventos Pendentes a Transferir</h4>
                        <div id="transferencia-proventos-disponiveis" style="margin-top: 15px;"></div>
                        <div class="form-actions"><button type="submit" class="btn btn-success">Registrar Transferência</button></div>
                    </div>
                </form>
            </div>
            <div class="container" id="lista-de-transferencias-container" style="margin-top: 30px;">
                <h2>Histórico de Transferências</h2>
                <div id="lista-de-transferencias"></div>
            </div>
        </div>
        <div id="tela-ajuste-pm" style="display: none;">
            <div class="page-header"><h1>Ajuste de Saldo Médio</h1></div>
            <div class="container">
                <h2>Ajustar Preço Médio em uma Data Específica</h2>
                <p>Selecione a data para carregar a posição e, em seguida, insira o novo preço médio para os ativos desejados. Esta ação não altera a quantidade de ativos, apenas seu custo de aquisição para cálculos futuros.</p>
                <form id="form-buscar-posicao-pm">
                    <div class="form-row" style="align-items: flex-end;">
                        <div class="form-group"><label for="ajuste-pm-data">Data da Posição</label><input type="date" id="ajuste-pm-data" required></div>
                        <div class="form-group"><button type="submit" class="btn btn-primary">Buscar Posições</button></div>
                    </div>
                </form>
            </div>
             <div class="container" id="container-ajuste-pm-lista" style="display:none;">
                <h3>Posição em <span id="ajuste-pm-data-selecionada"></span></h3>
                <form id="form-salvar-ajuste-pm">
                    <table>
                        <thead><tr><th>Ativo</th><th class="numero">Quantidade</th><th class="numero">Preço Médio Atual</th><th class="numero">Novo Preço Médio</th></tr></thead>
                        <tbody id="tabela-ajuste-pm"></tbody>
                    </table>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">Salvar Ajustes de Preço Médio</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="tela-proventos" style="display: none;">
            <div class="page-header">
                <h1>
                    Lançamento de Proventos
                </h1>
                <div class="page-header-filters">
                    <div id="botoes-proventos-padrao">
                        <button class="btn btn-primary" id="btn-novo-provento">Novo Lançamento</button>
                        <button class="btn btn-secondary" id="btn-adicionar-proventos-massa">Lançamento em Massa</button>
                        <button class="btn btn-secondary" id="btn-edicao-rapida-proventos">Edição Rápida</button>
                    </div>
                     <div id="botoes-proventos-edicao" style="display: none;">
                        <button class="btn btn-success" id="btn-salvar-edicao-rapida-proventos">Salvar Alterações</button>
                        <button type="button" class="btn btn-secondary" id="btn-cancelar-edicao-rapida-proventos">Cancelar</button>
                    </div>
            
                    <div style="margin-left: 20px; display: flex; align-items: center; gap: 20px;">
                        <i class="fas fa-file-export fa-lg acao-btn" id="btn-exportar-proventos" title="Exportar Proventos (CSV)"></i>
                        <i class="fas fa-file-upload fa-lg acao-btn" id="btn-importar-proventos" title="Importar Proventos (CSV)"></i>
                        <i class="fas fa-print fa-lg acao-btn" id="btn-imprimir-proventos" title="Imprimir Proventos Filtrados"></i>

                    </div>
                </div>
            </div>
            <div class="page-header-secondary">
                 <div class="page-header-filters">
                    <div class="form-group"><label>De:</label><input type="date" id="provento-filtro-data-de"></div>
                    <div class="form-group"><label>Até:</label><input type="date" id="provento-filtro-data-ate"></div>
                    <div class="form-group"><label>Filtrar por Ativo</label><input type="text" id="provento-filtro-ativo" placeholder="ex: ITUB4"></div>
                    <div class="form-group"><label>Filtrar por Tipo</label><select id="provento-filtro-tipo"><option value="todos">Todos os Tipos</option><option value="Ação">Ações</option><option value="FII">FIIs</option><option value="ETF">ETFs</option></select></div>
                    <div class="form-group"><label>Filtrar por Status</label><select id="provento-filtro-status"><option value="todos">Todos</option><option value="receber">A Receber</option><option value="recebido">Recebidos</option></select></div>
                    <div class="form-group"><label>Filtrar por Posição</label><select id="provento-filtro-posicao"><option value="todos" selected>Todos</option><option value="em_carteira">Em Carteira</option><option value="zerados">Zerados</option></select></div>
                </div>
            </div>
            <div class="container" id="proventos-summary-container">
                <div id="proventos-summary-ativo-info" style="display: none;">
                    </div>
                <h3 id="proventos-summary-titulo">Resumo do Período</h3>
                <div class="summary-panel-container">
                    <div class="summary-monetary-values">
                        <div class="summary-data-point large">
                            <label>Dividendo Total no Período</label>
                            <span id="summary-dividendo-total">R$ 0,00</span>
                        </div>
                        <div class="summary-data-point large">
                            <label>Projeção Anual (Posição Atual)</label>
                            <span id="summary-projecao-anual">R$ 0,00</span>
                        </div>
                        <div class="summary-data-point large">
                            <label>Média Mensal (Posição Atual)</label>
                            <span id="summary-media-mensal">R$ 0,00</span>
                        </div>
                    </div>
                    <hr>
                    <div class="summary-columns-container">
                        <div class="summary-column">
                            <h4>Yield sobre Custo (YOC)</h4>
                            <div class="summary-data-point">
                                <label>YOC Anualizado</label>
                                <span id="summary-yoc-anual">0,00%</span>
                            </div>
                            <div class="summary-data-point">
                                <label>YOC Mensal</label>
                                <span id="summary-yoc-mensal">0,00%</span>
                            </div>
                        </div>
                        <div class="summary-column">
                            <h4>Yield sobre Mercado</h4>
                            <div class="summary-data-point">
                                <label>Yield Anualizado</label>
                                <span id="summary-yield-mercado-anual">0,00%</span>
                            </div>
                            <div class="summary-data-point">
                                <label>Yield Mensal</label>
                                <span id="summary-yield-mercado-mensal">0,00%</span>
                            </div>
                        </div>
                    </div>
                    <div id="summary-media-unidade-container" class="summary-data-point" style="margin-top: 15px; text-align: center; display: none; flex-direction: row; justify-content: center; gap: 15px; align-items: center;">
                        <span>
                            <label>Média Mensal por Unidade</label>
                            <span id="summary-media-unidade-valor">R$ 0,00</span>
                        </span>
                        <span style="color: #ccc; font-size: 1.5em; font-weight: 100;">|</span>
                        <span>
                            <label>Total Pago por Unidade no Período</label>
                            <span id="summary-total-unidade-valor">R$ 0,00</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="container" id="lista-de-proventos"></div>
        </div>
        <div id="tela-renda-variavel" style="display: none;">
            <div class="page-header">
                <h1 id="titulo-tela-rv" class="titulo-clicavel-grafico" title="Clique para ver o gráfico de cotações de todos os ativos">Minha Posição em Renda Variável</h1>
                <div class="page-header-filters">
                    <button class="btn btn-primary" id="btn-adicionar-ativo-alocacao" title="Incluir um ativo que você ainda não possui na sua estratégia de alocação.">+ Adicionar Ativo para Alocação</button>
                    <div class="form-group">
                        <label>Filtrar por Corretora</label>
                        <select id="rv-filtro-corretora" class="broker-filter" data-tipo-ativo="RendaVariavel">
                            <option value="consolidado">Consolidado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Posição em</label>
                        <input type="date" id="rv-filtro-data" class="date-filter" data-tipo-ativo="RendaVariavel">
                    </div>
                </div>
            </div>
            <div class="page-header-summary" id="summary-rv">
                </div>
            <div class="logos-container" id="filtro-info-rv">
                </div>
            <div class="info-buttons-container" id="info-buttons-rv">
                <button class="info-button" data-action="performance">Performance</button>
                <button class="info-button" data-action="proventos">Proventos</button>
                <button class="info-button" data-action="alocacao">Alocação</button>
            </div>
            <div class="container" id="posicao-rv-container">
                </div>
        </div>
        <div id="tela-performanceRV" style="display: none;">
            <div class="page-header">
                <h1>Performance Consolidada de Ativos (RV)</h1>
                <div class="page-header-filters">
                    <div class="form-group">
                        <label for="performance-filtro-periodo">Exibir Períodos</label>
                        <select id="performance-filtro-periodo">
                            <option value="todos">Todos os Períodos</option>
                            <option value="atuais">Apenas Posições em Carteira</option>
                            <option value="encerrados">Apenas Posições Encerradas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="performance-filtro-tipo">Filtrar por Tipo</label>
                        <select id="performance-filtro-tipo">
                            <option value="todos">Todos os Tipos</option>
                            <option value="Ação">Ações</option>
                            <option value="FII">FIIs</option>
                            <option value="ETF">ETFs</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="container" id="container-tabela-performance">
                </div>
        </div>
    </main>

    <div id="custom-tooltip" class="custom-tooltip"></div>
    
    <div id="modal-ativo-detalhes" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="modal-ativo-detalhes-titulo"></h3>
            <div id="modal-ativo-detalhes-conteudo">
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-ativo-detalhes')">Fechar</button>
            </div>
        </div>
    </div>
    <div id="modal-resumo-negociacao" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="modal-resumo-negociacao-titulo">Resumo da Ordem de Compra/Venda</h3>
            <div id="modal-resumo-negociacao-conteudo">
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-cadastro-meta" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 id="modal-meta-titulo">Adicionar Nova Meta</h3>
            <form id="form-cadastro-meta">
                <input type="hidden" id="meta-id">
                <div class="form-group">
                    <label for="meta-nome">Nome da Meta</label>
                    <input type="text" id="meta-nome" placeholder="Ex: Atingir 100k em FIIs" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="meta-tipo">Tipo de Meta</label>
                        <select id="meta-tipo" required>
                            <option value="patrimonio_moeda">Patrimônio Investido Total</option>
                            <option value="renda_passiva_moeda">Renda Passiva Mensal</option>
                            <option value="renda_passiva_sm">Renda Passiva (em Salários Mínimos)</option>
                            <option value="posicao_ativo">Quantidade de um Ativo Específico</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="meta-valor-alvo" id="meta-label-alvo-padrao">Valor Alvo</label>
                        <label for="meta-valor-alvo" id="meta-label-alvo-sm" style="display: none;">Quantidade de Salários Mínimos</label>
                        <input type="text" id="meta-valor-alvo" required placeholder="Ex: 2">
                    </div>
                </div>
    
                <div id="meta-moeda-group" style="display: none;">
                    <div class="form-row-double">
                        <div class="form-group">
                            <label for="meta-moeda-alvo">Moeda da Meta</label>
                            <select id="meta-moeda-alvo">
                                <option value="BRL">Real (BRL)</option>
                                <option value="USD">Dólar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="GBP">Libra (GBP)</option>
                                </select>
                        </div>
                        <div class="form-group" id="meta-fonte-proventos-group" style="display: none;">
                            <label for="meta-fonte-proventos">Fonte dos Proventos</label>
                            <select id="meta-fonte-proventos">
                                <option value="total_rv">Renda Variável (RV)</option>
                                <option value="total_geral">RV + Renda Fixa</option>
                                <option value="fiis">Apenas FIIs</option>
                                <option value="acoes">Apenas Ações</option>
                            </select>
                        </div>
                    </div>
                </div>
    
                <div class="form-group" id="meta-ativo-alvo-group" style="display: none;">
                    <label for="meta-ativo-alvo">Ativo Alvo (Ticker)</label>
                    <input type="text" id="meta-ativo-alvo" class="ticker-input" placeholder="Ex: BBAS3">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Salvar Meta</button>
                </div>
            </form>
        </div>
    </div>
    <div id="floating-calculator" class="floating-calculator">
        <div class="calculator-header">
            <span><i class="fas fa-calculator"></i> Calculadora</span>
            <span class="close-calculator" title="Fechar">&times;</span>
        </div>
        <div id="calculator-display" class="calculator-display">0</div>
        <div class="calculator-buttons">
            <button class="calc-btn function" data-action="clear">C</button>
            <button class="calc-btn operator" data-value="/">÷</button>
            <button class="calc-btn operator" data-value="*">×</button>
            <button class="calc-btn function" data-action="backspace">⌫</button>
    
            <button class="calc-btn" data-value="7">7</button>
            <button class="calc-btn" data-value="8">8</button>
            <button class="calc-btn" data-value="9">9</button>
            <button class="calc-btn operator" data-value="-">−</button>
    
            <button class="calc-btn" data-value="4">4</button>
            <button class="calc-btn" data-value="5">5</button>
            <button class="calc-btn" data-value="6">6</button>
            <button class="calc-btn operator" data-value="+">+</button>
    
            <button class="calc-btn" data-value="1">1</button>
            <button class="calc-btn" data-value="2">2</button>
            <button class="calc-btn" data-value="3">3</button>
            <button class="calc-btn equals" data-action="calculate">=</button>
    
            <button class="calc-btn zero" data-value="0">0</button>
            <button class="calc-btn" data-value=".">,</button>
            <button class="calc-btn insert" data-action="insert">Inserir</button>
        </div>
    </div>
    <div id="modal-snapshot-detalhes" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <h3 id="modal-snapshot-detalhes-titulo"></h3>
            <div id="modal-snapshot-detalhes-conteudo">
                </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-grafico-cotacoes" class="modal">
        <div class="modal-content" style="width: 90%; max-width: 1000px; height: 600px;">
            <div class="modal-header">
                <h3 id="modal-grafico-cotacoes-titulo">Histórico</h3>
                <span class="close-btn" onclick="fecharModal('modal-grafico-cotacoes')">&times;</span>
            </div>
            
            <div class="chart-period-controls" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;">
                <input type="radio" id="periodo-1m" name="periodo-grafico-modal" value="1M" checked>
                <label for="periodo-1m" class="chart-period-btn">1 Mês</label>

                <input type="radio" id="periodo-ytd" name="periodo-grafico-modal" value="YTD">
                <label for="periodo-ytd" class="chart-period-btn">No Ano (YTD)</label>

                <input type="radio" id="periodo-1a" name="periodo-grafico-modal" value="1A">
                <label for="periodo-1a" class="chart-period-btn">1 Ano</label>

                <input type="radio" id="periodo-5a" name="periodo-grafico-modal" value="5A">
                <label for="periodo-5a" class="chart-period-btn">5 Anos</label>
            </div>

            <div class="modal-body" style="height: calc(100% - 100px);">
                <canvas id="grafico-cotacoes-historicas-canvas"></canvas>
            </div>
        </div>
    </div>
    <div id="modal-investimentos-detalhes" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="page-header" style="margin-bottom: 0;">
                <h3 id="modal-investimentos-detalhes-titulo">Detalhes da Carteira de Investimentos</h3>
                <p id="print-timestamp" class="print-only-timestamp"></p> 
                <i class="fas fa-print fa-lg acao-btn" id="btn-imprimir-investimentos" title="Imprimir Relatório"></i>
            </div>
            <div id="modal-investimentos-detalhes-conteudo" class="container" style="box-shadow: none; padding-top: 10px;">
            </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="modal-dashboard-alertas" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 id="modal-dashboard-alertas-titulo">Status da Carteira</h3>
            <div id="modal-dashboard-alertas-conteudo">
                </div>
            <p class="info-esc">Clique fora para sair</p>
        </div>
    </div>
    <div id="container-impressao-proventos" style="display: none;">
        <div id="impressao-cabecalho">
            <h1 id="impressao-titulo">Relatório de Proventos</h1>
            <p id="impressao-timestamp"></p>
            <p id="impressao-filtros"></p>
        </div>
        <div id="impressao-resumo"></div>
        <div id="impressao-tabela"></div>
    </div>
    <div id="container-impressao-ativo" style="display: none;">
    </div>
    <div id="container-impressao-ir" style="display: none;">
    </div>
    <script src="script.js"></script>
</body>
</html>